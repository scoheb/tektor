name: 'Tektor - Tekton Resource Validator'
description: 'Validate Tekton resources (Pipelines, Tasks, PipelineRuns) in pull requests using Tektor'
author: 'Tektor Team'

branding:
  icon: 'check-circle'
  color: 'blue'

inputs:
  files:
    description: 'Comma-separated list of files to validate. If not provided, will detect changed files automatically'
    required: false
    default: ''
  
  file-patterns:
    description: 'File patterns to match for Tekton resources (YAML/JSON files)'
    required: false
    default: '**/*.yaml,**/*.yml,**/*.json'
  
  exclude-patterns:
    description: 'File patterns to exclude from validation'
    required: false
    default: '.github/**,docs/**,README.md,**/README.md'
  
  fail-on-error:
    description: 'Whether to fail the action if validation errors are found'
    required: false
    default: 'true'
  
  verbose:
    description: 'Enable verbose logging output'
    required: false
    default: 'false'
  
  parameters:
    description: 'Runtime parameters for validation in key=value format, one per line'
    required: false
    default: ''
  
  detect-tekton-files:
    description: 'Auto-detect Tekton resource files by content (apiVersion: tekton.dev)'
    required: false
    default: 'true'

  changed-files-only:
    description: 'Only validate files that have changed in the PR (requires pull_request event)'
    required: false
    default: 'true'
  
  pr-url:
    description: 'Pull request URL to pass to tektor'
    required: false
    default: ''
  
  pr-branch:
    description: 'Pull request branch name to pass to tektor'
    required: false
    default: ''
  
  pr-base-branch:
    description: 'Pull request base branch name to pass to tektor'
    required: false
    default: ''

outputs:
  validated-files:
    description: 'List of files that were validated'
  
  validation-results:
    description: 'Summary of validation results'
  
  error-count:
    description: 'Number of validation errors found'
  
  warning-count:
    description: 'Number of validation warnings found'

runs:
  using: 'composite'
  steps:
    - name: Setup Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.22'
        
    - name: Build tektor
      shell: bash
      run: |
        cd ${{ github.action_path }}
        go build -o tektor main.go
        
    - name: Run tektor validation
      shell: bash
      env:
        GITHUB_TOKEN: ${{ github.token }}
      run: |
        export PATH="${{ github.action_path }}:$PATH"
        ${{ github.action_path }}/entrypoint.sh 
